{
  "$schema": "https://raw.githubusercontent.com/Azure/azure-devtestlab/master/schemas/2016-11-28/dtlArtifacts.json",
  "title": "MSP Security & Tools Suite",
  "description": "Installs a comprehensive suite of security analysis and system administration tools for MSP technicians. Includes malware analysis tools, PowerShell modules, network utilities, remote access tools, and log analysis capabilities.",
  "iconUri": "https://raw.githubusercontent.com/Azure/azure-devtestlab/master/Artifacts/windows-security-tools/icon.png",
  "targetOsType": "Windows",
  "parameters": {
    "installLocation": {
      "type": "string",
      "displayName": "Installation Directory",
      "description": "Root directory where MSP tools will be installed",
      "defaultValue": "C:\\MSP-Tools",
      "allowedValues": []
    },
    "createDesktopShortcuts": {
      "type": "bool",
      "displayName": "Create Desktop Shortcuts",
      "description": "Create desktop shortcuts for quick access to tools and directories",
      "defaultValue": true
    },
    "installPowerShellModules": {
      "type": "bool",
      "displayName": "Install PowerShell Modules",
      "description": "Install Microsoft 365, Azure AD, and security-related PowerShell modules",
      "defaultValue": true
    },
    "configureSecurityExclusions": {
      "type": "bool",
      "displayName": "Configure Security Exclusions",
      "description": "Add Windows Defender exclusions for tools directory to prevent interference with malware analysis",
      "defaultValue": true
    },
    "downloadSpecialtyTools": {
      "type": "bool",
      "displayName": "Download Specialty Tools",
      "description": "Attempt to download portable versions of IAS Log Viewer and VirusTotal CLI",
      "defaultValue": true
    }
  },
  "runCommand": {
    "commandToExecute": "[concat('powershell.exe -ExecutionPolicy Unrestricted -File ./Install-MSPTools.ps1', ' -InstallLocation \"', parameters('installLocation'), '\"', ' -CreateDesktopShortcuts $', parameters('createDesktopShortcuts'), ' -InstallPowerShellModules $', parameters('installPowerShellModules'), ' -ConfigureSecurityExclusions $', parameters('configureSecurityExclusions'), ' -DownloadSpecialtyTools $', parameters('downloadSpecialtyTools'))]"
  }
}